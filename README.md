# SabreTooth VObject library

[![Build Status](https://secure.travis-ci.org/evert/sabre-vobject.png?branch=master)](http://travis-ci.org/evert/sabre-vobject)

The VObject library allows you to easily parse and manipulate iCalendar and vCard objects using PHP.
The goal of the VObject library is to create a very complete library, with an easy to use API.

# Installation

VObject requires PHP 5.3, and should be installed using composer.
The general composer instructions can be found on the (composer website)[http://getcomposer.org/doc/00-intro.md composer website].

After that, just declare the vobject dependency as follows:

```
"require" : {
    "sabre/vobject" : "2.0.*"
}
```

Then, run `composer.phar update` and you should be good.

# Usage

## Parsing

For our example, we will be using the following vcard:

```
BEGIN:VCARD
VERSION:3.0
PRODID:-//Sabre//Sabre VObject 2.0//EN
N:Planck;Max;;;
FN:Max Planck
EMAIL;TYPE=WORK:mplanck@example.org
item1.TEL;TYPE=CELL:(+49)3144435678
item1.X-ABLabel:Private cell
item2.TEL;TYPE=WORK:(+49)5554564744
item2.X-ABLabel:Work
END:VCARD
```


If we want to just print out Max' full name, you can just use property access:


```php

use Sabre\VObject;

$card = VObject\Reader::read($data);
echo $card->FN;

```

## Changing properties

Creating properties is pretty similar. If we like to add his birthday, we just
set the property:

```php

$card->BDAY = '1858-04-23';

```

Note that in the previous example, we're actually updating any existing BDAY that
may already exist. If we want to add a new property, without overwriting the previous
we can do this with the `add` method. 

```php

$card->add('EMAIL','max@example.org');

```

## Parameters

If we want to also specify that this is max' home email addresses, we can do this with
a third parameter:

```

$card->add('EMAIL', 'max@example'org', array('type' => 'HOME'));

```

If we want to read out all the email addresses and their type, this would look something
like this:

```
foreach($card->EMAIL as $email) {

    echo $email['TYPE'], ' - ', $email;

}
```

## Groups

In our example, you can see that the TEL properties are prefixed. These are 'groups' and
allow you to group multiple related properties together. The group can be any user-defined
name.

This particular example as generated by the OS X addressbook, which uses the `X-ABLabel`
to allow the user to specify custom labels for properties. OS X addressbook uses groups
to tie the label to the property.

The VObject library simply ignores the group if you don't specify it, so this will work:

```php

foreach($card->TEL as $tel) {
    echo $tel, "\n";
}
```

But if you would like to target a specific group + property, this is possible too:

```php

echo $card->{'ITEM1.TEL'};

```

So if you would like to show all the phone numbers, along with their custom label, the
following syntax is used:

```
foreach($card->TEL as $tel) {

    echo $card->{$tel->group . '.X-ABLABEL'}, ": ";
    echo $tel, "\n";

}
```

## Serializing / Saving

If you want to generate your updated VObject, you can simply call the serialize() method.

```

echo $card->serialize();

``

## Components

iCalendar, unlike vCards always have sub-components. Where vCards are often just a flat
list, iCalendar objects tend to have a tree-like structure. For the following paragraphs,
we will use the following object as the example:

```
BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Sabre//Sabre VObject 2.0//EN
BEGIN:VEVENT
SUMMARY:Curiosity landing
DTSTART:20120806T051439Z
LOCATION:Mars
END:VEVENT
END:VCALENDAR
```

Since events, tasks and journals are always in a sub component, this is also how we
access them.

```php

use Sabre\VObject;

$calendar = VObject\Reader::read($data);
echo $calendar->VEVENT->SUMMARY;

```

Adding components to a calendar is done with a factory method:

```php

$event = VObject\Component::create('VEVENT');
$calendar->add($event);

$event->SUMMARY = 'Curiosity launch';
$event->DTSTART = '20111126T150202Z';
$event->LOCATION = 'Cape Carnival';

```

By the way.. cloning also works as expected, as the entire structure is cloned along with it:

```php

$clonedEvent = clone $calendar->VEVENT[0];
$calendar->add($clonedEvent);

```

## Date and time handling

If you ever had to deal with iCalendar timezones, you know it can be complicated.
The way timezones are specified is flawed, which is something I may write an essay about some
day. VObject does its best to determine the correct timezone. Many standard formats
have been tested and verified, and special code has been implemented for special-casing
microsoft generated timezone information, and others.

To get a real php `DateTime` object, you can request this as follows:

```
$event = $calendar->VEVENT;
$start = $event->DTSTART->getDateTime();
echo $start->format(\DateTime::W3C);
```

To set the property with a DateTime object, you can use the following syntax:

```
$dateTime = new \DateTime('2012-08-07 23:53:00', new DateTimeZone('Europe/Amsterdam'));
$event->DTSTART->setDateTime($dateTime, VObject\Property\DateTime::DATE);
```

The second argument specifies the type of date you're setting. The following three
options exist:

# `LOCAL` This is a floating time, with no timezone information. This basically specifies that the event happens in whatever the timezone's currently in. This would be encoded as `DTSTART;VALUE=DATE-TIME:20120807235300`
# `UTC` This specifies that the time should be encoded as a UTC time. This is encoded as `DTSTART;VALUE=DATE-TIME:20120807205300Z`. Note the extra Z and the fact that it's two hours 'earlier'.
# `LOCALTZ` specifies that it's supposed to be encoded in its local timezone. For example `DTSTART;VALUE=DATE-TIME;TZID=Europe/Amsterdam:20120807235300`.
# `DATE` This is a date-only, and does not contain the time. In this case this would be encoded as `DTSTART;VALUE=DATE:20120807`.

